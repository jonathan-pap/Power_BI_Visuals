var HierarchyFlowA1B2C3D4E5F6G7H8I9J0;(()=>{"use strict";var e={23(e,t,i){function s(){var e=this,t=[];return e.each(function(i){i!==e&&t.push({source:i.parent,target:i})}),t}i.d(t,{A:()=>s})},44(e,t,i){function s(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}i.d(t,{A:()=>s})},70(e,t,i){i.d(t,{bP:()=>x,lW:()=>b});var s=i(489),l=i(705),a=i(514),o=i(235),n=i(827),r=i(429),h=i(604),d=i(495),c=i(44),p=i(242),u=i(632),f=i(23),m=i(774);function g(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=v)):void 0===t&&(t=y);for(var i,s,l,a,o,n=new x(e),r=[n];i=r.pop();)if((l=t(i.data))&&(o=(l=Array.from(l)).length))for(i.children=l,a=o-1;a>=0;--a)r.push(s=l[a]=new x(l[a])),s.parent=i,s.depth=i.depth+1;return n.eachBefore(b)}function y(e){return e.children}function v(e){return Array.isArray(e)?e[1]:null}function w(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function b(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function x(e){this.data=e,this.depth=this.height=0,this.parent=null}x.prototype=g.prototype={constructor:x,count:s.A,each:l.A,eachAfter:o.A,eachBefore:a.A,find:n.A,sum:r.A,sort:h.A,path:d.A,ancestors:c.A,descendants:p.A,leaves:u.A,links:f.A,copy:function(){return g(this).eachBefore(w)},[Symbol.iterator]:m.A}},214(e,t,i){i.d(t,{Q0:()=>Z});const s="TD",l=70,a=18,o=120,n=40,r=!0,h="#ffffff",d="#f3b27a",c="#f08b2e",p=1,u="solid",f=!0,m="arrow",g=6,y="#ffffff",v="#e5e7eb",w=1,b=6,x="rounded",S=!0,F="#111827",C="#6b7280",I="center",N=!0,M=11,T="Segoe UI",k="bold",z=!1,V=["#ffffff","#f8fafc","#f1f5f9","#e2e8f0","#e0f2fe","#ede9fe"],L=!0,A=!0,D=!0,E=!0,P=!0,H=!0,B=!0,R=!0,W="tree",G=130,K=!0,j=28,O=!0;function Z(e){const t=e?.metadata?.objects??{},i=t.layout??{},Z=t.appearance??{},X=t.lines??{},Q=t.nodes??{},q=t.levels??{},J=t.controls??{},ee=t.table??{},te=[_(q.level1Color,V[0]),_(q.level2Color,V[1]),_(q.level3Color,V[2]),_(q.level4Color,V[3]),_(q.level5Color,V[4]),_(q.level6Color,V[5])];return{layout:{orientation:i.orientation??s,levelSpacing:$(i.levelSpacing,l),siblingSpacing:$(i.siblingSpacing,a),cardWidth:$(i.cardWidth,o),cardHeight:$(i.cardHeight,n)},appearance:{useBackground:U(Z.useBackground,r),backgroundColor:_(Z.backgroundColor,h)},lines:{lineColor:_(X.lineColor,d),activeColor:_(X.activeColor,c),lineWidth:$(X.lineWidth,p),lineStyle:Y(X.lineStyle,["solid","dashed"],u),showArrows:U(X.showArrows,f),tipStyle:Y(X.tipStyle,["arrow","none","square","diamond","circle"],m),tipSize:$(X.tipSize,g)},nodes:{fillColor:_(Q.fillColor,y),strokeColor:_(Q.strokeColor,v),strokeWidth:$(Q.strokeWidth,w),cornerRadius:$(Q.cornerRadius,b),shape:Y(Q.shape,["rounded","square","pill"],x),showShadow:U(Q.showShadow,S),titleColor:_(Q.titleColor,F),valueColor:_(Q.valueColor,C),titleAlign:Y(Q.titleAlign,["left","center","right"],I),titleWrap:U(Q.titleWrap,N),titleFontSize:$(Q.titleFontSize,M),titleFontFamily:(ie=Q.titleFontFamily,se=T,"string"==typeof ie&&ie.trim().length>0?ie:se),titleFontStyle:Y(Q.titleFontStyle,["normal","bold","italic","boldItalic"],k)},levels:{enable:U(q.enableLevelColors,z),levelColors:te},controls:{showControls:U(J.showControls,L),showSearch:U(J.showSearch,A),showHierarchyFilter:U(J.showHierarchyFilter,D),showParentFilter:U(J.showParentFilter,E),showDropdownFilter:U(J.showDropdownFilter,P),showZoom:U(J.showZoom,H),showViewToggle:U(J.showViewToggle,B),showCollapseExpand:U(J.showCollapseExpand,R),defaultView:Y(J.defaultView,["tree","table"],W),doubleClickZoomPercent:$(J.doubleClickZoomPercent,G)},table:{showHeader:U(ee.showHeader,K),rowHeight:$(ee.rowHeight,j),zebra:U(ee.zebra,O)}};var ie,se}function $(e,t){const i=Number(e);return Number.isFinite(i)?i:t}function U(e,t){return"boolean"==typeof e?e:t}function Y(e,t,i){return"string"==typeof e&&t.includes(e)?e:i}function _(e,t){if(!e)return t;if("string"==typeof e)return e;const i=e.solid;return i&&"string"==typeof i.color?i.color:t}},235(e,t,i){function s(e,t){for(var i,s,l,a=this,o=[a],n=[],r=-1;a=o.pop();)if(n.push(a),i=a.children)for(s=0,l=i.length;s<l;++s)o.push(i[s]);for(;a=n.pop();)e.call(t,a,++r,this);return this}i.d(t,{A:()=>s})},242(e,t,i){function s(){return Array.from(this)}i.d(t,{A:()=>s})},279(e,t,i){i.d(t,{b:()=>f});var s=i(904),l=i(768),a=i(214),o=i(674),n=i(810);const r="#ffffff",h="#f08b2e",d="#111827",c="#6b7280",p="#f08b2e",u="#fff4e6";class f{host;selectionManager;tooltipService;localizationManager;formattingSettingsService;formattingSettingsModel;root;canvas;ctx;settings;viewMode="tree";userSetView=!1;toolbar;viewGroup;zoomGroup;collapseGroup;searchGroup;searchInput;filterGroup;hierarchyFilter;parentFilter;dropdownFilter;zoomLabel;treeButton;tableButton;collapseAllButton;expandAllButton;tableContainer;tableEl;tableHead;tableBody;tableRows=[];landingPage;focusedNodeId=null;focusedIndex=0;tx=20;ty=20;scale=1;nodes=[];links=[];nodeRects=[];toggleRects=[];lastViewportW=0;lastViewportH=0;hoveredId=null;selectedIds=new Set;searchQuery="";hierarchyFilterValue=null;parentFilterValue=null;dropdownFilterValue=null;allRows=[];fullRows=[];childrenMap=new Map;fullChildrenMap=new Map;collapsedIds=new Set;valueDisplayName="Value";sparklineDisplayName="Sparkline";tooltipDisplayName="Tooltip";labelDisplayName="Name";dropdownDisplayName="Dropdown";hasDropdownField=!1;sparklineMin=null;sparklineMax=null;allowInteractions=!0;constructor(e){this.host=e.host,this.selectionManager=this.host.createSelectionManager(),this.tooltipService=this.host.tooltipService,this.localizationManager=this.host.createLocalizationManager(),this.formattingSettingsService=new o.O,this.formattingSettingsModel=new n.S,this.root=e.element,this.root.style.position="relative",this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",this.canvas.style.touchAction="none",this.canvas.tabIndex=0,this.canvas.setAttribute("role","application"),this.canvas.setAttribute("aria-label",this.localize("Visual.Name","Hierarchy Flow")),this.root.appendChild(this.canvas);const t=this.canvas.getContext("2d");if(!t)throw new Error("Canvas not supported.");this.ctx=t,this.settings=(0,a.Q0)(void 0),this.createToolbar(),this.createTable(),this.createLandingPage(),this.wireInteractions()}update(e){const t=this.host.eventService;t?.renderingStarted(e);const i=e.dataViews?.[0],s=e.viewport;this.allowInteractions=!1!==this.host.allowInteractions,this.lastViewportW=s.width,this.lastViewportH=s.height,this.resizeCanvas(s.width,s.height),this.formattingSettingsModel=i?this.formattingSettingsService.populateFormattingSettingsModel(n.S,i):new n.S,this.settings=(0,a.Q0)(i),this.updateLandingPageStyle(),this.userSetView&&this.settings.controls.showViewToggle||(this.viewMode=this.settings.controls.defaultView),this.applyToolbarSettings();try{const s=this.parseDataView(i);if(!s||0===s.length)return this.nodes=[],this.links=[],this.tableRows=[],this.allRows=[],this.childrenMap.clear(),this.sparklineMin=null,this.sparklineMax=null,this.hasDropdownField=!1,this.dropdownDisplayName=this.localize("Toolbar.FilterDropdown","Dropdown filter"),this.updateFilterOptions(),this.applyToolbarSettings(),this.clearMessage(),this.showLandingPage(!0),void t?.renderingFinished(e);this.clearMessage(),this.showLandingPage(!1);const l=!0===i?.metadata?.isDataFilterApplied,a=this.fullRows.length>0,o=a&&s.length<this.fullRows.length,n=l&&a&&o&&this.hasAllIds(this.fullRows,s);if(n||(this.fullRows=s,this.fullChildrenMap=this.buildChildrenMap(this.fullRows)),this.allRows=n?this.expandRowsForFilter(s,this.fullRows):s,this.childrenMap=this.fullChildrenMap.size?this.fullChildrenMap:this.buildChildrenMap(this.allRows),this.setSparklineRange(this.allRows),this.updateFilterOptions(),this.applyToolbarSettings(),!this.computeLayoutFromState())return void t?.renderingFailed(e,this.localize("Message.InvalidHierarchy","Invalid hierarchy: duplicates, cycles, or missing parents."));this.ensureFocus(),i?.metadata?.segment&&this.host.fetchMoreData?.(),this.renderView(),t?.renderingFinished(e)}catch(i){const s=i instanceof Error?i.message:void 0;t?.renderingFailed(e,s)}}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettingsModel)}resizeCanvas(e,t){const i=window.devicePixelRatio||1;this.canvas.width=Math.max(1,Math.floor(e*i)),this.canvas.height=Math.max(1,Math.floor(t*i)),this.ctx.setTransform(i,0,0,i,0,0)}parseDataView(e){const t=e?.categorical,i=t?.categories;if(!i||i.length<2)return null;const s=i.find(e=>e.source.roles?.hierarchy),l=i.find(e=>e.source.roles?.parent),a=i.filter(e=>e.source.roles?.fields),o=i.find(e=>e.source.roles?.dropdown);if(!s||!l)return null;this.labelDisplayName=a.length>0?this.localize("Table.Header.Fields","Fields"):s.source?.displayName??this.localize("Table.Header.Fields","Fields"),this.dropdownDisplayName=o?.source?.displayName??this.localize("Toolbar.FilterDropdown","Dropdown filter"),this.hasDropdownField=Boolean(o);const n=t?.values,r=n?.find(e=>e.source.roles?.sparkline),h=n?.find(e=>e.source.roles?.values),d=n?.find(e=>e.source.roles?.tooltip);this.sparklineDisplayName=r?.source?.displayName??"Sparkline",this.valueDisplayName=h?.source?.displayName??"Value",this.tooltipDisplayName=d?.source?.displayName??"Tooltip";const c=[],p=s.values.length;for(let e=0;e<p;e++){const t=String(s.values[e]??"").trim();if(!t)continue;const i=l.values[e],n=null==i||""===String(i).trim()?null:String(i).trim(),p=a.length>0&&a.map(t=>t.values[e]).map(e=>null==e?"":String(e).trim()).filter(Boolean).join(" / ")||t,u=r?this.getValueWithHighlight(r,e):null,f=h?this.getValueWithHighlight(h,e):null,m=d?d.values[e]:null,g=o?o.values[e]:null,y=null==g?null:String(g),v=this.host.createSelectionIdBuilder().withCategory(s,e).createSelectionId();c.push({id:t,parentId:n,label:p,value:f,sparkline:u,tooltip:m,dropdown:y,selectionId:v})}return c}getValueWithHighlight(e,t){const i=e.highlights;if(i&&i.length>t){const e=i[t];if(null!=e)return e}return e.values[t]}buildChildrenMap(e){const t=new Map;for(const i of e){if(!i.parentId)continue;const e=t.get(i.parentId)??[];e.push(i.id),t.set(i.parentId,e)}return t}hasAllIds(e,t){const i=new Set(e.map(e=>e.id));for(const e of t)if(!i.has(e.id))return!1;return!0}expandRowsForFilter(e,t){if(0===e.length)return[];const i=new Map(t.map(e=>[e.id,e])),s=new Map(e.map(e=>[e.id,e])),l=new Set;for(const t of e){let e=t.id;for(;;){const t=i.get(e)?.parentId;if(!t||!i.has(t))break;e=t}l.add(e)}const a=new Set,o=Array.from(l);for(;o.length;){const e=o.pop();if(a.has(e))continue;a.add(e);const t=this.fullChildrenMap.get(e)??[];for(const e of t)o.push(e)}return t.filter(e=>a.has(e.id)).map(e=>{const t=s.get(e.id);return t?{...e,value:t.value,sparkline:t.sparkline,tooltip:t.tooltip,selectionId:t.selectionId}:{...e,value:null,sparkline:null,tooltip:null}})}applySearchFilter(e,t){const i=t.trim().toLowerCase();if(!i)return e;const s=new Map(e.map(e=>[e.id,e])),l=new Set;for(const t of e){if(!(t.label??"").toLowerCase().includes(i))continue;let e=t.id;for(;;){const t=s.get(e)?.parentId;if(!t||!s.has(t))break;e=t}l.add(e)}if(0===l.size)return[];const a=new Set,o=Array.from(l);for(;o.length;){const e=o.pop();if(a.has(e))continue;a.add(e);const t=this.childrenMap.get(e)??[];for(const e of t)o.push(e)}return e.filter(e=>a.has(e.id))}applyDropdownFilters(e){let t=e;return this.hierarchyFilterValue&&(t=this.filterToNodeBranch(t,this.hierarchyFilterValue)),this.parentFilterValue&&(t=this.filterToParentBranch(t,this.parentFilterValue)),this.dropdownFilterValue&&(t=this.filterToDropdownBranch(t,this.dropdownFilterValue)),t}filterToNodeBranch(e,t){const i=new Map(e.map(e=>[e.id,e]));if(!i.has(t))return e;const s=new Set;let l=t;for(;l;){s.add(l);const e=i.get(l)?.parentId??null;if(!e||!i.has(e))break;l=e}const a=[t];for(;a.length;){const e=a.pop(),t=this.childrenMap.get(e)??[];for(const e of t)s.has(e)||(s.add(e),a.push(e))}return e.filter(e=>s.has(e.id))}filterToParentBranch(e,t){const i=new Map(e.map(e=>[e.id,e])),s=e.filter(e=>e.parentId===t).map(e=>e.id);if(0===s.length)return e;const l=new Set;let a=t;for(;a;){i.has(a)&&l.add(a);const e=i.get(a)?.parentId??null;if(!e||!i.has(e))break;a=e}const o=[...s];for(const e of s)l.add(e);for(;o.length;){const e=o.pop(),t=this.childrenMap.get(e)??[];for(const e of t)l.has(e)||(l.add(e),o.push(e))}return e.filter(e=>l.has(e.id))}filterToDropdownBranch(e,t){const i=new Map(e.map(e=>[e.id,e])),s=new Set;if(e.filter(e=>(e.dropdown??"").trim()===t||e.label===t||e.id===t).forEach(e=>{const t=e.parentId&&i.has(e.parentId)?e.parentId:e.id;s.add(t)}),0===s.size)return[];const l=new Set;for(const e of s){if(!i.has(e))continue;let t=e;for(;t;){l.add(t);const e=i.get(t)?.parentId??null;if(!e||!i.has(e))break;t=e}const s=[e];for(;s.length;){const e=s.pop(),t=this.childrenMap.get(e)??[];for(const e of t)l.has(e)||(l.add(e),s.push(e))}}return e.filter(e=>l.has(e.id))}updateFilterOptions(){if(!this.hierarchyFilter||!this.parentFilter)return;const e=this.fullRows.length>0?this.fullRows:this.allRows,t=new Set,i=new Set,s=new Set;for(const l of e)t.add(l.id),l.parentId&&i.add(l.parentId),l.dropdown&&s.add(l.dropdown);const l=(e,t,i)=>{const s=e.value;for(;e.firstChild;)e.removeChild(e.firstChild);const l=document.createElement("option");l.value="",l.textContent=i,e.appendChild(l);for(const i of t){const t=document.createElement("option");t.value=i,t.textContent=i,e.appendChild(t)}const a=s&&t.includes(s)?s:"";return e.value=a,a||null},a=Array.from(t).sort((e,t)=>e.localeCompare(t)),o=Array.from(i).sort((e,t)=>e.localeCompare(t));this.hierarchyFilterValue=l(this.hierarchyFilter,a,this.localize("Toolbar.FilterHierarchyAll","All hierarchy")),this.parentFilterValue=l(this.parentFilter,o,this.localize("Toolbar.FilterParentAll","All parents"));const n=Array.from(s).sort((e,t)=>e.localeCompare(t)),r=this.dropdownDisplayName?`${this.localize("Toolbar.FilterDropdownAll","All")}: ${this.dropdownDisplayName}`:this.localize("Toolbar.FilterDropdownAll","All dropdown");this.dropdownFilterValue=l(this.dropdownFilter,n,r),this.hasDropdownField=n.length>0}setSparklineRange(e){const t=[];for(const i of e)"number"==typeof i.sparkline&&Number.isFinite(i.sparkline)&&t.push(i.sparkline);if(0===t.length)return this.sparklineMin=null,void(this.sparklineMax=null);this.sparklineMin=Math.min(...t),this.sparklineMax=Math.max(...t)}computeLayoutFromState(e=!0,t){const i=this.computeVisibleRows(this.allRows,this.collapsedIds);if(0===i.length)return this.nodes=[],this.links=[],this.tableRows=[],(this.searchQuery||this.hierarchyFilterValue||this.parentFilterValue)&&this.clearAndMessage(this.localize("Message.NoMatches","No matches.")),!0;const s=e?null:this.getNodeScreenPoint(t??null);return!!this.computeLayout(i,e)&&(!e&&t&&s&&this.keepNodeScreenPosition(t,s),!0)}computeVisibleRows(e,t){const i=this.applyDropdownFilters(e),s=this.applySearchFilter(i,this.searchQuery),l=new Set;for(const e of s)l.add(e.id);const a=s.filter(e=>!e.parentId||!l.has(e.parentId)),o=new Set,n=[];for(const e of a)n.push(e.id);for(;n.length;){const e=n.pop();if(o.has(e))continue;if(o.add(e),t.has(e))continue;const i=this.childrenMap.get(e)??[];for(const e of i)n.push(e)}return s.filter(e=>o.has(e.id))}computeLayout(e,t=!0){const i=this.settings.layout,a=new Set(e.map(e=>e.id)),o=e.filter(e=>!e.parentId||!a.has(e.parentId));let n,r=e.slice(),h=null;if(1!==o.length){h="__root__";const e={id:h,parentId:null,label:"All",selectionId:this.host.createSelectionIdBuilder().createSelectionId()};r=[...r,e];for(const e of o){const t=r.findIndex(t=>t.id===e.id);t>=0&&(r[t]={...r[t],parentId:h})}}try{n=(0,s.A)().id(e=>e.id).parentId(e=>e.parentId??void 0)(r)}catch(e){this.nodes=[],this.links=[],this.tableRows=[];const t=this.localize("Message.InvalidHierarchy","Invalid hierarchy: duplicates, cycles, or missing parents.");return this.host.displayWarningIcon?.(t,t),this.clearAndMessage(t),!1}const d=(0,l.A)().nodeSize([i.cardWidth+i.siblingSpacing,i.cardHeight+i.levelSpacing])(n),c=[],p=[],u=[],f=new Map,m=h?1:0;if(d.eachBefore(e=>{const t=e.data,i={id:t.id,label:t.label,value:t.value,sparkline:t.sparkline,tooltip:t.tooltip,x:e.x,y:e.y,selectionId:t.selectionId,depth:e.depth-m};f.set(e,i),c.push(i),p.push(i)}),d.each(e=>{const t=f.get(e);if(t&&e.children)for(const i of e.children){const e=f.get(i);e&&(e.parent=t,(t.children??=[]).push(e),u.push({source:t,target:e}))}}),h?(this.nodes=c.filter(e=>e.id!==h),this.links=u.filter(e=>e.source.id!==h),this.tableRows=p.filter(e=>e.id!==h)):(this.nodes=c,this.links=u,this.tableRows=p),"LR"===i.orientation)for(const e of this.nodes){const t=e.x;e.x=e.y,e.y=t}return t&&this.fitToViewport(),!0}getNodeScreenPoint(e){if(!e)return null;const t=this.nodes.find(t=>t.id===e);return t?{x:t.x*this.scale+this.tx,y:t.y*this.scale+this.ty}:null}keepNodeScreenPosition(e,t){const i=this.nodes.find(t=>t.id===e);i&&(this.tx=t.x-i.x*this.scale,this.ty=t.y-i.y*this.scale,this.updateZoomLabel())}fitToViewport(){if(0===this.nodes.length||this.lastViewportW<=0||this.lastViewportH<=0)return;const e=this.settings.layout;let t=1/0,i=1/0,s=-1/0,l=-1/0;for(const a of this.nodes){const o=a.x-e.cardWidth/2,n=a.y-e.cardHeight/2,r=o+e.cardWidth,h=n+e.cardHeight;t=Math.min(t,o),i=Math.min(i,n),s=Math.max(s,r),l=Math.max(l,h)}const a=s-t,o=l-i,n=Math.max(1,this.lastViewportW-48),r=Math.max(1,this.lastViewportH-48),h=n/Math.max(1,a),d=r/Math.max(1,o);this.scale=Math.min(2,Math.max(.2,Math.min(h,d)));const c=(t+s)/2,p=(i+l)/2;this.tx=this.lastViewportW/2-c*this.scale,this.ty=this.lastViewportH/2-p*this.scale,this.updateZoomLabel()}localize(e,t){const i=this.localizationManager?.getDisplayName(e);return i||t}createToolbar(){this.toolbar=document.createElement("div"),this.toolbar.style.position="absolute",this.toolbar.style.top="8px",this.toolbar.style.right="8px",this.toolbar.style.display="flex",this.toolbar.style.gap="6px",this.toolbar.style.zIndex="10",this.toolbar.style.font="600 11px Segoe UI";const e=()=>{const e=document.createElement("div");return e.style.display="flex",e.style.alignItems="center",e.style.background="#ffffff",e.style.border="1px solid #d1d5db",e.style.borderRadius="6px",e.style.boxShadow="0 1px 2px rgba(0,0,0,0.08)",e.style.overflow="hidden",e},t=(e,t)=>{const i=document.createElement("button");return i.type="button",i.textContent=e,i.title=t,i.style.padding="4px 6px",i.style.border="none",i.style.background="transparent",i.style.cursor="pointer",i.style.color="#111827",i.style.font="600 11px Segoe UI",i.addEventListener("pointerdown",e=>{e.stopPropagation()}),i};this.searchGroup=e(),this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.placeholder=this.localize("Toolbar.SearchPlaceholder","Search"),this.searchInput.setAttribute("aria-label",this.localize("Toolbar.SearchPlaceholder","Search")),this.searchInput.style.border="none",this.searchInput.style.outline="none",this.searchInput.style.padding="4px 6px",this.searchInput.style.font="600 11px Segoe UI",this.searchInput.style.minWidth="120px",this.searchInput.style.background="transparent",this.searchInput.style.color="#111827",this.searchInput.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.searchInput.addEventListener("input",()=>{const e=this.searchInput.value??"";this.setSearchQuery(e)});const i=t("×",this.localize("Toolbar.SearchClear","Clear search"));i.style.fontSize="12px",i.addEventListener("click",e=>{e.stopPropagation(),this.searchInput.value="",this.setSearchQuery("")}),this.searchGroup.appendChild(this.searchInput),this.searchGroup.appendChild(i);const s=e=>{e.style.border="none",e.style.outline="none",e.style.padding="4px 6px",e.style.font="600 11px Segoe UI",e.style.background="transparent",e.style.color="#111827",e.style.maxWidth="140px"};this.filterGroup=e(),this.hierarchyFilter=document.createElement("select"),this.hierarchyFilter.setAttribute("aria-label",this.localize("Toolbar.FilterHierarchy","Hierarchy filter")),s(this.hierarchyFilter),this.hierarchyFilter.addEventListener("pointerdown",e=>e.stopPropagation()),this.hierarchyFilter.addEventListener("change",()=>{this.setHierarchyFilter(this.hierarchyFilter.value)}),this.parentFilter=document.createElement("select"),this.parentFilter.setAttribute("aria-label",this.localize("Toolbar.FilterParent","Parent filter")),s(this.parentFilter),this.parentFilter.addEventListener("pointerdown",e=>e.stopPropagation()),this.parentFilter.addEventListener("change",()=>{this.setParentFilter(this.parentFilter.value)}),this.dropdownFilter=document.createElement("select"),this.dropdownFilter.setAttribute("aria-label",this.localize("Toolbar.FilterDropdown","Dropdown filter")),s(this.dropdownFilter),this.dropdownFilter.addEventListener("pointerdown",e=>e.stopPropagation()),this.dropdownFilter.addEventListener("change",()=>{this.setDropdownFilter(this.dropdownFilter.value)}),this.filterGroup.appendChild(this.hierarchyFilter),this.filterGroup.appendChild(this.parentFilter),this.filterGroup.appendChild(this.dropdownFilter),this.viewGroup=e(),this.treeButton=t(this.localize("Toolbar.Tree","Tree"),"Tree view"),this.tableButton=t(this.localize("Toolbar.Table","Table"),"Table view"),this.viewGroup.appendChild(this.treeButton),this.viewGroup.appendChild(this.tableButton),this.treeButton.addEventListener("click",e=>{e.stopPropagation(),this.setViewMode("tree",!0)}),this.tableButton.addEventListener("click",e=>{e.stopPropagation(),this.setViewMode("table",!0)}),this.collapseGroup=e(),this.collapseAllButton=t(this.localize("Toolbar.Collapse","Collapse"),"Collapse all"),this.expandAllButton=t(this.localize("Toolbar.Expand","Expand"),"Expand all"),this.collapseGroup.appendChild(this.collapseAllButton),this.collapseGroup.appendChild(this.expandAllButton),this.collapseAllButton.addEventListener("click",e=>{e.stopPropagation(),this.collapseAll()}),this.expandAllButton.addEventListener("click",e=>{e.stopPropagation(),this.expandAll()}),this.zoomGroup=e();const l=t("-",this.localize("Toolbar.ZoomOut","Zoom out")),a=t("+",this.localize("Toolbar.ZoomIn","Zoom in"));this.zoomLabel=document.createElement("input"),this.zoomLabel.type="text",this.zoomLabel.value="100%",this.zoomLabel.inputMode="numeric",this.zoomLabel.setAttribute("aria-label",this.localize("Toolbar.ZoomInput","Zoom percent")),this.zoomLabel.style.padding="2px 4px",this.zoomLabel.style.minWidth="44px",this.zoomLabel.style.textAlign="center",this.zoomLabel.style.border="none",this.zoomLabel.style.outline="none",this.zoomLabel.style.background="transparent",this.zoomLabel.style.font="600 11px Segoe UI",this.zoomLabel.style.color="#111827",this.zoomLabel.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.zoomGroup.appendChild(l),this.zoomGroup.appendChild(this.zoomLabel),this.zoomGroup.appendChild(a);const o=()=>{if("tree"!==this.viewMode)return void this.updateZoomLabel();const e=this.zoomLabel.value.trim(),t=Number.parseFloat(e.replace("%",""));if(!Number.isFinite(t))return void this.updateZoomLabel();const i=Math.min(400,Math.max(20,t))/100,s=this.scale;if(i===s)return void this.updateZoomLabel();const l=this.lastViewportW/2,a=this.lastViewportH/2;this.tx=l-(l-this.tx)*(i/s),this.ty=a-(a-this.ty)*(i/s),this.scale=i,this.updateZoomLabel(),this.renderTree(this.lastViewportW,this.lastViewportH)};this.zoomLabel.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),o(),this.canvas.focus())}),this.zoomLabel.addEventListener("blur",()=>o()),l.addEventListener("click",e=>{e.stopPropagation(),this.zoomBy(.9)}),a.addEventListener("click",e=>{e.stopPropagation(),this.zoomBy(1.1)}),this.toolbar.appendChild(this.searchGroup),this.toolbar.appendChild(this.filterGroup),this.toolbar.appendChild(this.viewGroup),this.toolbar.appendChild(this.collapseGroup),this.toolbar.appendChild(this.zoomGroup),this.root.appendChild(this.toolbar)}createTable(){this.tableContainer=document.createElement("div"),this.tableContainer.style.position="absolute",this.tableContainer.style.inset="0",this.tableContainer.style.display="none",this.tableContainer.style.overflow="auto",this.tableContainer.style.font="12px Segoe UI",this.tableContainer.tabIndex=0,this.tableContainer.setAttribute("role","grid"),this.tableContainer.setAttribute("aria-label",this.localize("Visual.Name","Hierarchy Flow")),this.tableEl=document.createElement("table"),this.tableHead=document.createElement("thead"),this.tableBody=document.createElement("tbody"),this.tableEl.appendChild(this.tableHead),this.tableEl.appendChild(this.tableBody),this.tableContainer.appendChild(this.tableEl),this.root.appendChild(this.tableContainer)}createLandingPage(){this.landingPage=document.createElement("div"),this.landingPage.style.position="absolute",this.landingPage.style.inset="0",this.landingPage.style.display="none",this.landingPage.style.alignItems="center",this.landingPage.style.justifyContent="center",this.landingPage.style.textAlign="center",this.landingPage.style.padding="24px",this.landingPage.style.font="12px Segoe UI",this.landingPage.style.color=c,this.landingPage.style.pointerEvents="none";const e=document.createElement("div");e.style.font="600 14px Segoe UI",e.style.marginBottom="6px",e.textContent=this.localize("Landing.Title","Build your hierarchy");const t=document.createElement("div");t.textContent=this.localize("Landing.Body","Add Hierarchy Field, Parent Field, and Name to start. Optional: Sparkline, Values, Tooltip."),this.landingPage.appendChild(e),this.landingPage.appendChild(t),this.root.appendChild(this.landingPage)}showLandingPage(e){this.landingPage&&(this.landingPage.style.display=e?"flex":"none",e&&(this.canvas.style.display="none",this.tableContainer&&(this.tableContainer.style.display="none")))}updateLandingPageStyle(){if(!this.landingPage)return;const e=this.host.colorPalette,t=e?.isHighContrast,i=t?e?.background?.value:this.settings?.appearance?.useBackground?this.settings.appearance.backgroundColor:"transparent",s=t?e?.foreground?.value:c;this.landingPage.style.background=i||"transparent",this.landingPage.style.color=s||c}ensureFocus(){const e="table"===this.viewMode?this.tableRows:this.nodes;if(!e.length)return this.focusedNodeId=null,void(this.focusedIndex=0);let t=e.findIndex(e=>e.id===this.focusedNodeId);t<0&&(t=0),this.focusedIndex=t,this.focusedNodeId=e[t].id}applyToolbarSettings(){const e=this.settings.controls,t=e.showDropdownFilter&&this.hasDropdownField;this.toolbar.style.display=e.showControls?"flex":"none",this.searchGroup.style.display=e.showSearch?"flex":"none",this.filterGroup.style.display=e.showHierarchyFilter||e.showParentFilter||t?"flex":"none",this.hierarchyFilter.style.display=e.showHierarchyFilter?"inline-flex":"none",this.parentFilter.style.display=e.showParentFilter?"inline-flex":"none",this.dropdownFilter.style.display=t?"inline-flex":"none",this.viewGroup.style.display=e.showViewToggle?"flex":"none",this.zoomGroup.style.display=e.showZoom?"flex":"none",this.collapseGroup.style.display=e.showCollapseExpand?"flex":"none",this.toolbar.style.pointerEvents=this.allowInteractions?"auto":"none",this.toolbar.style.opacity=this.allowInteractions?"1":"0.6",!e.showSearch&&this.searchQuery&&(this.searchQuery="",this.searchInput&&(this.searchInput.value=""),this.clearMessage(),this.computeLayoutFromState(!0),this.renderView()),!e.showHierarchyFilter&&this.hierarchyFilterValue&&(this.hierarchyFilterValue=null,this.hierarchyFilter&&(this.hierarchyFilter.value=""),this.clearMessage(),this.computeLayoutFromState(!0),this.renderView()),!e.showParentFilter&&this.parentFilterValue&&(this.parentFilterValue=null,this.parentFilter&&(this.parentFilter.value=""),this.clearMessage(),this.computeLayoutFromState(!0),this.renderView()),e.showDropdownFilter&&this.hasDropdownField||!this.dropdownFilterValue||(this.dropdownFilterValue=null,this.dropdownFilter&&(this.dropdownFilter.value=""),this.clearMessage(),this.computeLayoutFromState(!0),this.renderView())}syncToolbarState(){if(!this.toolbar)return;this.updateZoomLabel();const e="#e5e7eb",t="transparent";this.treeButton.style.background="tree"===this.viewMode?e:t,this.tableButton.style.background="table"===this.viewMode?e:t,"table"===this.viewMode?this.zoomGroup.style.display="none":this.zoomGroup.style.display=this.settings.controls.showZoom?"flex":"none"}setViewMode(e,t=!1){this.viewMode!==e&&(this.viewMode=e,t&&(this.userSetView=!0),this.hoveredId=null,this.ensureFocus(),this.hideTooltip(),this.renderView())}zoomBy(e){if("tree"!==this.viewMode)return;const t=this.scale,i=Math.min(4,Math.max(.2,this.scale*e)),s=this.lastViewportW/2,l=this.lastViewportH/2;this.tx=s-(s-this.tx)*(i/t),this.ty=l-(l-this.ty)*(i/t),this.scale=i,this.updateZoomLabel(),this.renderTree(this.lastViewportW,this.lastViewportH)}updateZoomLabel(){this.zoomLabel&&(this.zoomLabel.value=`${Math.round(100*this.scale)}%`)}collapseAll(){this.collapsedIds.clear();for(const[e]of this.childrenMap)this.collapsedIds.add(e);this.computeLayoutFromState(),this.renderView()}expandAll(){this.collapsedIds.clear(),this.computeLayoutFromState(),this.renderView()}renderView(){if(this.syncToolbarState(),"table"===this.viewMode)return this.canvas.style.display="none",this.tableContainer.style.display="block",void this.renderTable();this.tableContainer.style.display="none",this.canvas.style.display="block",this.renderTree(this.lastViewportW,this.lastViewportH)}setSearchQuery(e){const t=e.trim();this.searchQuery!==t&&(this.searchQuery=t,this.clearMessage(),this.hideTooltip(),this.computeLayoutFromState(!0),this.ensureFocus(),this.renderView())}setHierarchyFilter(e){const t=e||null;this.hierarchyFilterValue!==t&&(this.hierarchyFilterValue=t,this.clearMessage(),this.hideTooltip(),this.computeLayoutFromState(!0),this.ensureFocus(),this.renderView())}setParentFilter(e){const t=e||null;this.parentFilterValue!==t&&(this.parentFilterValue=t,this.clearMessage(),this.hideTooltip(),this.computeLayoutFromState(!0),this.ensureFocus(),this.renderView())}setDropdownFilter(e){const t=e||null;this.dropdownFilterValue!==t&&(this.dropdownFilterValue=t,this.clearMessage(),this.hideTooltip(),this.computeLayoutFromState(!0),this.ensureFocus(),this.renderView())}clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}renderTable(){const e=this.settings.table,t=this.settings.appearance,i=this.settings.nodes,s=this.host.colorPalette,l=s?.getColor?.("HierarchyFlowAccent")?.value??p,a=!0===s?.isHighContrast,o=s?.foreground?.value,n=s?.background?.value,f=a?n||r:t.useBackground?t.backgroundColor:"transparent",m=a?o||d:i.titleColor||d,g=a?n||"#ffffff":t.useBackground?t.backgroundColor:"#ffffff",y=a&&o||"#e5e7eb",v=a?o||"#e5e7eb":"#f3f4f6",w=a?o||i.valueColor:i.valueColor||c,b=this.getTitleFontSpec();if(this.tableContainer.style.background=f,this.tableContainer.style.color=m,this.tableEl.style.width="100%",this.tableEl.style.borderCollapse="collapse",this.clearElement(this.tableHead),e.showHeader){const e=document.createElement("tr"),t=[this.labelDisplayName||this.localize("Table.Header.Fields","Fields"),this.valueDisplayName||this.localize("Table.Header.Value","Value"),this.sparklineDisplayName||this.localize("Table.Header.Sparkline","Sparkline")];for(const i of t){const t=document.createElement("th");t.textContent=i,t.style.textAlign="left",t.style.font="600 12px Segoe UI",t.style.padding="6px 8px",t.style.borderBottom=`1px solid ${y}`,t.style.position="sticky",t.style.top="0",t.style.background=g,e.appendChild(t)}this.tableHead.appendChild(e)}this.clearElement(this.tableBody);const x=Math.max(20,e.rowHeight);for(let t=0;t<this.tableRows.length;t++){const s=this.tableRows[t],d=document.createElement("tr");d.style.cursor=this.allowInteractions?"pointer":"default",this.selectedIds.has(s.id)?a?(d.style.background=o||h,d.style.color=n||r):d.style.background=u:!a&&e.zebra&&t%2==1&&(d.style.background="#f9fafb"),s.id===this.focusedNodeId&&(d.style.outline=`2px dashed ${a?o||h:l}`,d.style.outlineOffset="-2px");const c=document.createElement("td");c.style.padding="0 8px",c.style.height=`${x}px`,c.style.borderBottom=`1px solid ${v}`,c.style.font=b.font,c.style.textAlign=i.titleAlign,c.style.whiteSpace=i.titleWrap?"normal":"nowrap",c.style.overflow="hidden",c.style.textOverflow=i.titleWrap?"clip":"ellipsis";const p=8+14*Math.max(0,s.depth);if(c.style.paddingLeft=`${p}px`,(this.childrenMap.get(s.id)?.length??0)>0){const e=document.createElement("span");e.textContent=this.collapsedIds.has(s.id)?"+":"–",e.style.display="inline-block",e.style.width="14px",e.style.height="14px",e.style.lineHeight="14px",e.style.textAlign="center",e.style.marginRight="6px",e.style.border=`1px solid ${a&&o||"#d1d5db"}`,e.style.borderRadius="3px",e.style.cursor="pointer",e.addEventListener("click",e=>{e.stopPropagation(),this.toggleCollapse(s.id)}),c.appendChild(e)}else{const e=document.createElement("span");e.style.display="inline-block",e.style.width="20px",c.appendChild(e)}const f=document.createElement("span");f.textContent=s.label,c.appendChild(f);const m=document.createElement("td");m.style.padding="0 8px",m.style.height=`${x}px`,m.style.borderBottom=`1px solid ${v}`,m.style.color=w,m.textContent=this.formatValue(s.value);const g=document.createElement("td");g.style.padding="0 8px",g.style.height=`${x}px`,g.style.borderBottom=`1px solid ${v}`,g.style.color=w;const y=this.formatValue(s.sparkline);if("number"==typeof s.sparkline&&null!==this.sparklineMin){const e=(this.sparklineMax??this.sparklineMin)-this.sparklineMin,t=0===e?1:(s.sparkline-this.sparklineMin)/e,i=document.createElement("div");i.style.height="6px",i.style.width=`${Math.max(6,Math.round(60*Math.max(0,Math.min(1,t))))}px`,i.style.background=a&&o||l,i.style.borderRadius="3px",g.appendChild(i)}else g.textContent=y;d.appendChild(c),d.appendChild(m),d.appendChild(g),d.addEventListener("click",async e=>{if(!this.allowInteractions)return;const i=e.ctrlKey||e.metaKey;this.focusedNodeId=s.id,this.focusedIndex=t,this.tableContainer.focus(),i?this.selectedIds.has(s.id)?this.selectedIds.delete(s.id):this.selectedIds.add(s.id):(this.selectedIds.clear(),this.selectedIds.add(s.id)),await this.selectionManager.select(s.selectionId,i),this.renderView()}),this.tableBody.appendChild(d)}}renderTree(e,t){const i=this.ctx,s=this.settings.layout,l=this.settings.appearance,a=this.settings.lines,o=this.settings.nodes,n=this.settings.levels,h=this.host.colorPalette,f=h?.getColor?.("HierarchyFlowAccent")?.value??p,m=!0===h?.isHighContrast,g=h?.foreground?.value,y=h?.background?.value,v=m&&g||a.lineColor,w=m&&g||a.activeColor,b=m&&y||o.fillColor,x=m&&g||o.strokeColor,S=m&&g||o.titleColor,F=m&&g||o.valueColor,C=a.showArrows?a.tipStyle:"none",I=Math.max(2,a.tipSize);i.clearRect(0,0,e,t),m?(i.fillStyle=y||r,i.fillRect(0,0,e,t)):l.useBackground&&(i.fillStyle=l.backgroundColor||r,i.fillRect(0,0,e,t)),i.save(),i.translate(this.tx,this.ty),i.scale(this.scale,this.scale);const N=Math.max(0,a.lineWidth);if(N>0){i.lineWidth=N/this.scale,i.setLineDash("dashed"===a.lineStyle?[4/this.scale,3/this.scale]:[]);for(const e of this.links){const t=this.hoveredId&&(e.source.id===this.hoveredId||e.target.id===this.hoveredId);i.strokeStyle=t?w:v;const l=e.source.x,a=e.source.y,o=e.target.x,n=e.target.y;if("TD"===s.orientation){const e=a+s.cardHeight/2,t=n-s.cardHeight/2,r=(e+t)/2;i.beginPath(),i.moveTo(l,e),i.lineTo(l,r),i.lineTo(o,r),i.lineTo(o,t),i.stroke(),"none"!==C&&this.drawLineTip(i,o,t,"down",C,I)}else{const e=l+s.cardWidth/2,t=o-s.cardWidth/2,r=(e+t)/2;i.beginPath(),i.moveTo(e,a),i.lineTo(r,a),i.lineTo(r,n),i.lineTo(t,n),i.stroke(),"none"!==C&&this.drawLineTip(i,t,n,"right",C,I)}}i.setLineDash([])}this.nodeRects=[],this.toggleRects=[];for(const e of this.nodes){const t=e.x-s.cardWidth/2,l=e.y-s.cardHeight/2,a=s.cardWidth,r=s.cardHeight,h=this.hoveredId===e.id,p=this.selectedIds.has(e.id),v=(this.childrenMap.get(e.id)?.length??0)>0,C=14,I=6,N=v?C+10:6,M=Math.max(0,a-I-N);i.save(),o.showShadow&&!m?(i.shadowColor="rgba(15, 23, 42, 0.08)",i.shadowBlur=h||p?10:6,i.shadowOffsetY=2):(i.shadowColor="transparent",i.shadowBlur=0,i.shadowOffsetY=0);const T=n.enable&&n.levelColors[e.depth%n.levelColors.length]||b;i.fillStyle=p?u:T,i.strokeStyle=p?f:h?w:x,i.lineWidth=Math.max(0,o.strokeWidth)/this.scale;const k="pill"===o.shape?Math.min(a/2,r/2):"square"===o.shape?0:Math.max(0,o.cornerRadius);this.roundRect(i,t,l,a,r,k),i.fill(),i.stroke(),i.restore(),this.focusedNodeId===e.id&&(i.save(),i.strokeStyle=m&&g||w,i.lineWidth=1.5/this.scale,i.setLineDash([3/this.scale,2/this.scale]),this.roundRect(i,t,l,a,r,k),i.stroke(),i.restore());const z=this.getTitleFontSpec(),V="left"===o.titleAlign?"left":"right"===o.titleAlign?"right":"center",L="left"===V?t+I:"right"===V?t+I+M:t+I+M/2;i.textBaseline="top",i.textAlign=V,i.fillStyle=S||d,i.font=z.font,o.titleWrap?this.drawWrappedText(i,e.label,L,l+6,M,z.lineHeight,2,V):this.drawSingleLineText(i,e.label,L,l+6,M);const A=this.formatValue(e.value);if(A&&(i.fillStyle=F||c,i.font="500 10px Segoe UI",i.textBaseline="bottom",i.textAlign="center",i.fillText(A,t+a/2,l+r-6)),"number"==typeof e.sparkline&&Number.isFinite(e.sparkline)&&null!==this.sparklineMin){const s=(this.sparklineMax??this.sparklineMin)-this.sparklineMin,o=0===s?1:(e.sparkline-this.sparklineMin)/s,n=(a-16)*Math.max(0,Math.min(1,o)),h=A?l+r-14:l+r-8;i.strokeStyle=m&&g||f,i.lineWidth=2/this.scale,i.beginPath(),i.moveTo(t+8,h),i.lineTo(t+8+n,h),i.stroke()}if(v){const s=C,o=C,n=t+a-s-6,r=l+6;i.fillStyle=m&&y||"#ffffff",i.strokeStyle=m&&g||"#d1d5db",i.lineWidth=1/this.scale,this.roundRect(i,n,r,s,o,3),i.fill(),i.stroke();const h=this.collapsedIds.has(e.id);i.fillStyle=m&&g||"#f08b2e",i.font="700 10px Segoe UI",i.textBaseline="middle",i.textAlign="center",i.fillText(h?"+":"–",n+s/2,r+o/2+.25),i.textAlign="left",i.textBaseline="top",this.toggleRects.push({nodeId:e.id,x:n,y:r,w:s,h:o})}this.nodeRects.push({node:e,x:t,y:l,w:a,h:r})}i.restore()}roundRect(e,t,i,s,l,a){const o=Math.min(a,s/2,l/2);e.beginPath(),e.moveTo(t+o,i),e.arcTo(t+s,i,t+s,i+l,o),e.arcTo(t+s,i+l,t,i+l,o),e.arcTo(t,i+l,t,i,o),e.arcTo(t,i,t+s,i,o),e.closePath()}drawLineTip(e,t,i,s,l,a){const o=a/this.scale;if(e.save(),e.fillStyle=e.strokeStyle,e.strokeStyle=e.strokeStyle,"arrow"===l)return e.beginPath(),"down"===s?(e.moveTo(t,i),e.lineTo(t-o,i-1.5*o),e.lineTo(t+o,i-1.5*o)):(e.moveTo(t,i),e.lineTo(t-1.5*o,i-o),e.lineTo(t-1.5*o,i+o)),e.closePath(),e.fill(),void e.restore();if(e.translate(t,i),"down"===s&&e.rotate(Math.PI/2),"square"===l){const t=o;e.beginPath(),e.rect(-t,-t,2*t,2*t),e.fill()}else if("diamond"===l){const t=o;e.rotate(Math.PI/4),e.beginPath(),e.rect(-t,-t,2*t,2*t),e.fill()}else"circle"===l&&(e.beginPath(),e.arc(0,0,o,0,2*Math.PI),e.fill());e.restore()}ellipsis(e,t){return e?e.length<=t?e:e.slice(0,t-1)+"…":""}formatValue(e){return null==e?"":"number"==typeof e&&Number.isFinite(e)?e.toLocaleString():String(e)}getTitleFontSpec(){const e=this.settings.nodes,t=Math.max(6,e.titleFontSize||11),i=(e.titleFontFamily||"Segoe UI").trim()||"Segoe UI";let s="normal",l="600";switch(e.titleFontStyle){case"bold":l="700";break;case"italic":s="italic";break;case"boldItalic":s="italic",l="700";break;default:s="normal",l="600"}return{font:`${s} ${l} ${t}px ${i}`,size:t,lineHeight:Math.max(10,t+2)}}drawSingleLineText(e,t,i,s,l){if(!t)return;const a=String(t);if(e.measureText(a).width<=l)return void e.fillText(a,i,s);let o=0,n=a.length;for(;o<n;){const t=Math.floor((o+n)/2),i=a.slice(0,t)+"…";e.measureText(i).width<=l?o=t+1:n=t}const r=Math.max(0,o-1);e.fillText(a.slice(0,r)+"…",i,s)}drawWrappedText(e,t,i,s,l,a,o,n="left"){const r=e.textAlign;e.textAlign=n;const h=(t??"").split(/\s+/).filter(Boolean);if(0===h.length)return void(e.textAlign=r);let d="",c=0;for(let t=0;t<h.length;t++){const n=h[t],p=d?d+" "+n:n;if(e.measureText(p).width>l&&d){if(e.fillText(d,i,s+c*a),c++,c>=o-1){const l=h.slice(t).join(" ");return e.fillText(this.ellipsis(l,40),i,s+c*a),void(e.textAlign=r)}d=n}else d=p}d&&c<o&&e.fillText(d,i,s+c*a),e.textAlign=r}buildTooltipItems(e){const t=[];e.label&&t.push({displayName:this.labelDisplayName,value:e.label});const i=this.formatValue(e.value);i&&t.push({displayName:this.valueDisplayName,value:i});const s=this.formatValue(e.sparkline);s&&t.push({displayName:this.sparklineDisplayName,value:s});const l=this.formatValue(e.tooltip);return l&&t.push({displayName:this.tooltipDisplayName,value:l}),t}showTooltip(e,t){if(!this.tooltipService||!this.tooltipService.enabled())return;const i=this.buildTooltipItems(e.node);0!==i.length&&this.tooltipService.show({coordinates:[t.clientX,t.clientY],isTouchEvent:"touch"===t.pointerType,dataItems:i,identities:[e.node.selectionId]})}moveTooltip(e,t){this.tooltipService&&this.tooltipService.enabled()&&this.tooltipService.move({coordinates:[t.clientX,t.clientY],isTouchEvent:"touch"===t.pointerType,identities:[e.node.selectionId]})}hideTooltip(){this.tooltipService&&this.tooltipService.enabled()&&this.tooltipService.hide({isTouchEvent:!1,immediately:!0})}clearAndMessage(e){this.ctx.clearRect(0,0,this.lastViewportW,this.lastViewportH),this.settings?.appearance?.useBackground&&(this.ctx.fillStyle=this.settings.appearance.backgroundColor||r,this.ctx.fillRect(0,0,this.lastViewportW,this.lastViewportH)),this.canvas.style.display="block",this.tableContainer&&(this.tableContainer.style.display="none"),this.showLandingPage(!1);let t=this.root.querySelector(".pbi-msg");t||(t=document.createElement("div"),t.className="pbi-msg",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.padding="10px",t.style.pointerEvents="none",this.root.style.position="relative",this.root.appendChild(t));const i=this.host.colorPalette,s=i?.isHighContrast?i.foreground?.value:c;t.style.color=s||c,t.textContent=e}clearMessage(){const e=this.root.querySelector(".pbi-msg");e&&e.remove()}onKeyDown(e){const t="table"===this.viewMode?this.tableRows:this.nodes;if(!t.length)return;let i=t.findIndex(e=>e.id===this.focusedNodeId);i<0&&(i=0);let s=!0;switch(e.key){case"ArrowDown":case"ArrowRight":i=Math.min(t.length-1,i+1);break;case"ArrowUp":case"ArrowLeft":i=Math.max(0,i-1);break;case"Home":i=0;break;case"End":i=t.length-1;break;case"Enter":case" ":if(!this.allowInteractions)return;return this.focusedNodeId=t[i].id,this.focusedIndex=i,this.selectedIds.clear(),this.selectedIds.add(t[i].id),this.selectionManager.select(t[i].selectionId,!1),this.renderView(),void e.preventDefault();case"+":case"=":return this.focusedNodeId=t[i].id,this.focusedIndex=i,this.collapsedIds.has(t[i].id)&&this.toggleCollapse(t[i].id),void e.preventDefault();case"-":case"_":return this.focusedNodeId=t[i].id,this.focusedIndex=i,this.collapsedIds.has(t[i].id)||this.toggleCollapse(t[i].id),void e.preventDefault();default:s=!1}s&&(e.preventDefault(),this.focusedNodeId=t[i].id,this.focusedIndex=i,this.renderView())}wireInteractions(){let e=!1,t=0,i=0;this.canvas.addEventListener("pointerdown",s=>{"tree"===this.viewMode&&(this.canvas.setPointerCapture(s.pointerId),e=1===s.button||s.shiftKey,t=s.clientX,i=s.clientY,this.hideTooltip())}),this.canvas.addEventListener("pointermove",s=>{if("tree"!==this.viewMode)return;if(e){const e=s.clientX-t,l=s.clientY-i;return t=s.clientX,i=s.clientY,this.tx+=e,this.ty+=l,void this.renderTree(this.lastViewportW,this.lastViewportH)}const l=this.hitTest(s.clientX,s.clientY),a=l?l.node.id:null,o=this.hoveredId;a!==this.hoveredId&&(this.hoveredId=a,this.canvas.style.cursor=l?"pointer":"default",this.renderTree(this.lastViewportW,this.lastViewportH)),l?o!==l.node.id?this.showTooltip(l,s):this.moveTooltip(l,s):this.hideTooltip()}),this.canvas.addEventListener("pointerup",()=>{"tree"===this.viewMode&&(e=!1)}),this.canvas.addEventListener("pointerleave",()=>{"tree"===this.viewMode&&(this.hoveredId=null,this.hideTooltip(),this.renderTree(this.lastViewportW,this.lastViewportH))}),this.canvas.addEventListener("wheel",e=>{if("tree"!==this.viewMode)return;e.preventDefault(),this.hideTooltip();const t=-e.deltaY>0?1.1:.9,i=this.scale,s=Math.min(4,Math.max(.2,this.scale*t)),l=this.canvas.getBoundingClientRect(),a=e.clientX-l.left,o=e.clientY-l.top;this.tx=a-(a-this.tx)*(s/i),this.ty=o-(o-this.ty)*(s/i),this.scale=s,this.updateZoomLabel(),this.renderTree(this.lastViewportW,this.lastViewportH)},{passive:!1}),this.canvas.addEventListener("dblclick",e=>{if("tree"!==this.viewMode)return;if(!this.allowInteractions)return;const t=this.hitTest(e.clientX,e.clientY);if(!t)return;if(this.isToggleHit(t.node.id,t.worldX,t.worldY))return;const i=Math.max(10,this.settings.controls.doubleClickZoomPercent)/100,s=Math.min(4,Math.max(.2,this.scale*i)),l=this.lastViewportW/2,a=this.lastViewportH/2;this.tx=l-t.node.x*s,this.ty=a-t.node.y*s,this.scale=s,this.updateZoomLabel(),this.renderTree(this.lastViewportW,this.lastViewportH)}),this.canvas.addEventListener("contextmenu",async e=>{if(e.preventDefault(),!this.allowInteractions)return;if("tree"!==this.viewMode)return;const t=this.hitTest(e.clientX,e.clientY);if(!t)return;this.selectedIds.clear(),this.selectedIds.add(t.node.id),await this.selectionManager.select(t.node.selectionId,!1);const i={x:e.clientX,y:e.clientY};this.selectionManager.showContextMenu?.(t.node.selectionId,i),this.renderTree(this.lastViewportW,this.lastViewportH)}),this.canvas.addEventListener("click",async e=>{if(e.shiftKey)return;if(!this.allowInteractions)return;if("tree"!==this.viewMode)return;const t=this.hitTest(e.clientX,e.clientY);if(!t)return this.selectedIds.clear(),this.focusedNodeId=null,await this.selectionManager.clear(),void this.renderTree(this.lastViewportW,this.lastViewportH);if(this.focusedNodeId=t.node.id,this.focusedIndex=this.nodes.findIndex(e=>e.id===t.node.id),this.canvas.focus(),this.isToggleHit(t.node.id,t.worldX,t.worldY))return void this.toggleCollapse(t.node.id);const i=e.ctrlKey||e.metaKey;i?this.selectedIds.has(t.node.id)?this.selectedIds.delete(t.node.id):this.selectedIds.add(t.node.id):(this.selectedIds.clear(),this.selectedIds.add(t.node.id)),await this.selectionManager.select(t.node.selectionId,i),this.renderTree(this.lastViewportW,this.lastViewportH)}),this.canvas.addEventListener("keydown",e=>this.onKeyDown(e)),this.tableContainer.addEventListener("keydown",e=>this.onKeyDown(e)),this.canvas.addEventListener("focus",()=>{"tree"===this.viewMode&&(this.ensureFocus(),this.renderTree(this.lastViewportW,this.lastViewportH))}),this.tableContainer.addEventListener("focus",()=>{"table"===this.viewMode&&(this.ensureFocus(),this.renderTable())})}toggleCollapse(e){(this.childrenMap.get(e)?.length??0)>0&&(this.collapsedIds.has(e)?this.collapsedIds.delete(e):this.collapsedIds.add(e),this.computeLayoutFromState(!1,e),this.renderView())}isToggleHit(e,t,i){for(let s=this.toggleRects.length-1;s>=0;s--){const l=this.toggleRects[s];if(l.nodeId===e&&t>=l.x&&t<=l.x+l.w&&i>=l.y&&i<=l.y+l.h)return!0}return!1}hitTest(e,t){const i=this.canvas.getBoundingClientRect(),s=e-i.left,l=t-i.top,a=(s-this.tx)/this.scale,o=(l-this.ty)/this.scale;for(let e=this.nodeRects.length-1;e>=0;e--){const t=this.nodeRects[e];if(a>=t.x&&a<=t.x+t.w&&o>=t.y&&o<=t.y+t.h)return{node:t.node,worldX:a,worldY:o,localX:a-t.x,localY:o-t.y}}return null}}},429(e,t,i){function s(e){return this.eachAfter(function(t){for(var i=+e(t.data)||0,s=t.children,l=s&&s.length;--l>=0;)i+=s[l].value;t.value=i})}i.d(t,{A:()=>s})},489(e,t,i){function s(e){var t=0,i=e.children,s=i&&i.length;if(s)for(;--s>=0;)t+=i[s].value;else t=1;e.value=t}function l(){return this.eachAfter(s)}i.d(t,{A:()=>l})},495(e,t,i){function s(e){for(var t=this,i=function(e,t){if(e===t)return e;var i=e.ancestors(),s=t.ancestors(),l=null;for(e=i.pop(),t=s.pop();e===t;)l=e,e=i.pop(),t=s.pop();return l}(t,e),s=[t];t!==i;)t=t.parent,s.push(t);for(var l=s.length;e!==i;)s.splice(l,0,e),e=e.parent;return s}i.d(t,{A:()=>s})},514(e,t,i){function s(e,t){for(var i,s,l=this,a=[l],o=-1;l=a.pop();)if(e.call(t,l,++o,this),i=l.children)for(s=i.length-1;s>=0;--s)a.push(i[s]);return this}i.d(t,{A:()=>s})},604(e,t,i){function s(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}i.d(t,{A:()=>s})},632(e,t,i){function s(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}i.d(t,{A:()=>s})},639(e,t,i){function s(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function l(e,t,i){return null==t||"object"==typeof t&&!t.solid?i:t.solid?{value:null==t?void 0:t.solid.color}:"Dropdown"===(null==e?void 0:e.type)&&e.items?e.items.find(e=>e.value==t):t}i.d(t,{D:()=>l,y:()=>s})},667(e,t,i){i.d(t,{A:()=>l});var s=i(754);const l=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var i,l;const a=new e,o=null===(i=null==t?void 0:t.metadata)||void 0===i?void 0:i.objects;return o&&(null===(l=a.cards)||void 0===l||l.forEach(e=>{var t;e instanceof s.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(o,e.name)),(e instanceof s.Tn?[e]:e.groups).forEach(t=>{var i,s,l,a;null===(i=t.topLevelSlice)||void 0===i||i.setPropertiesValues(o,e.name),null===(s=null==t?void 0:t.slices)||void 0===s||s.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)}),null===(a=null===(l=null==t?void 0:t.container)||void 0===l?void 0:l.containerItems)||void 0===a||a.forEach(t=>{var i;null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)})})})})),a}buildFormattingModel(e){const t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var i;const l={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane},a=e.name;if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(a,this.localizationManager);t.suppressDisplayName=!0,l.topLevelToggle=t}null===(i=e.onPreProcess)||void 0===i||i.call(e);const o=e instanceof s.Tn;(o?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",i={displayName:o?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:o?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};l.groups.push(i);const s={};if(e.container){const l=e.container,o=t+"-container",n={displayName:this.localizationManager&&l.displayNameKey?this.localizationManager.getDisplayName(l.displayNameKey):l.displayName,description:this.localizationManager&&l.descriptionKey?this.localizationManager.getDisplayName(l.descriptionKey):l.description,containerItems:[],uid:o};l.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,i=o+t,l={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:i};this.buildFormattingSlices({slices:e.slices,objectName:a,sliceNames:s,formattingSlices:l.slices}),n.containerItems.push(l)}),i.container=n}if(e.slices){if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(a,this.localizationManager);t.suppressDisplayName=!0,(null==i.displayName?l:i).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:a,sliceNames:s,formattingSlices:i.slices})}}),l.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(l)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:i,formattingSlices:s}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{const l=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);l&&(void 0===i[e.name]?i[e.name]=0:(i[e.name]++,l.uid=`${l.uid}-${i[e.name]}`),s.push(l))})}getRevertToDefaultDescriptor(e){var t;const i={},l=[];let a,o=[];return e instanceof s.St&&e.topLevelSlice&&l.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof s.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var s,n;a=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i,t.topLevelSlice),null===(n=null===(s=t.container)||void 0===s?void 0:s.containerItems)||void 0===n||n.forEach(t=>{o=o.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i))}),l.push(...a.concat(o))}),l}getSlicesRevertToDefaultDescriptor(e,t,i,s){let l=[];return s&&(i[s.name]=!0,l=l.concat(s.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!i[t.name]&&(i[t.name]=!0,l=l.concat(t.getRevertToDefaultDescriptor(e)))}),l}}},674(e,t,i){i.d(t,{O:()=>l.A,z:()=>s});var s=i(754),l=i(667)},705(e,t,i){function s(e,t){let i=-1;for(const s of this)e.call(t,s,++i,this);return this}i.d(t,{A:()=>s})},754(e,t,i){i.d(t,{Kx:()=>o,PA:()=>u,St:()=>n,Tn:()=>r,iB:()=>p,jF:()=>d,ks:()=>f,sk:()=>c});var s=i(639);class l{}class a extends l{}class o{}class n extends l{}class r extends a{}class h extends l{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const i=this.type,s=this.name,l={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+s};return Object.assign(Object.assign({},l),{control:{type:i,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:s.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var i;const l=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i[this.name];this.value=s.D(this,l,this.value)}}class d extends h{constructor(e){super(e),this.type="ToggleSwitch"}}class c extends h{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class p extends h{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}class u extends h{constructor(e){super(e),this.type="Dropdown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{items:this.items})}}class f extends h{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}},768(e,t,i){i.d(t,{A:()=>d});var s=i(70);function l(e,t){return e.parent===t.parent?1:2}function a(e){var t=e.children;return t?t[0]:e.t}function o(e){var t=e.children;return t?t[t.length-1]:e.t}function n(e,t,i){var s=i/(t.i-e.i);t.c-=s,t.s+=i,e.c+=s,t.z+=i,t.m+=i}function r(e,t,i){return e.a.parent===t.parent?e.a:i}function h(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function d(){var e=l,t=1,i=1,s=null;function d(l){var a=function(e){for(var t,i,s,l,a,o=new h(e,0),n=[o];t=n.pop();)if(s=t._.children)for(t.children=new Array(a=s.length),l=a-1;l>=0;--l)n.push(i=t.children[l]=new h(s[l],l)),i.parent=t;return(o.parent=new h(null,0)).children=[o],o}(l);if(a.eachAfter(c),a.parent.m=-a.z,a.eachBefore(p),s)l.eachBefore(u);else{var o=l,n=l,r=l;l.eachBefore(function(e){e.x<o.x&&(o=e),e.x>n.x&&(n=e),e.depth>r.depth&&(r=e)});var d=o===n?1:e(o,n)/2,f=d-o.x,m=t/(n.x+d+f),g=i/(r.depth||1);l.eachBefore(function(e){e.x=(e.x+f)*m,e.y=e.depth*g})}return l}function c(t){var i=t.children,s=t.parent.children,l=t.i?s[t.i-1]:null;if(i){!function(e){for(var t,i=0,s=0,l=e.children,a=l.length;--a>=0;)(t=l[a]).z+=i,t.m+=i,i+=t.s+(s+=t.c)}(t);var h=(i[0].z+i[i.length-1].z)/2;l?(t.z=l.z+e(t._,l._),t.m=t.z-h):t.z=h}else l&&(t.z=l.z+e(t._,l._));t.parent.A=function(t,i,s){if(i){for(var l,h=t,d=t,c=i,p=h.parent.children[0],u=h.m,f=d.m,m=c.m,g=p.m;c=o(c),h=a(h),c&&h;)p=a(p),(d=o(d)).a=t,(l=c.z+m-h.z-u+e(c._,h._))>0&&(n(r(c,t,s),t,l),u+=l,f+=l),m+=c.m,u+=h.m,g+=p.m,f+=d.m;c&&!o(d)&&(d.t=c,d.m+=m-f),h&&!a(p)&&(p.t=h,p.m+=u-g,s=t)}return s}(t,l,t.parent.A||s[0])}function p(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function u(e){e.x*=t,e.y=e.depth*i}return d.separation=function(t){return arguments.length?(e=t,d):e},d.size=function(e){return arguments.length?(s=!1,t=+e[0],i=+e[1],d):s?null:[t,i]},d.nodeSize=function(e){return arguments.length?(s=!0,t=+e[0],i=+e[1],d):s?[t,i]:null},d}h.prototype=Object.create(s.bP.prototype)},774(e,t,i){function*s(){var e,t,i,s,l=this,a=[l];do{for(e=a.reverse(),a=[];l=e.pop();)if(yield l,t=l.children)for(i=0,s=t.length;i<s;++i)a.push(t[i])}while(a.length)}i.d(t,{A:()=>s})},810(e,t,i){i.d(t,{S:()=>I});var s=i(674),l=s.z.Kx,a=s.z.Tn,o=s.z.jF,n=s.z.sk,r=s.z.iB,h=s.z.PA,d=s.z.ks;const c=[{value:"TD",displayName:"Top-Down"},{value:"LR",displayName:"Left-Right"}],p=[{value:"solid",displayName:"Solid"},{value:"dashed",displayName:"Dashed"}],u=[{value:"arrow",displayName:"Arrow"},{value:"none",displayName:"None"},{value:"square",displayName:"Square"},{value:"diamond",displayName:"Diamond"},{value:"circle",displayName:"Circle"}],f=[{value:"rounded",displayName:"Rounded"},{value:"square",displayName:"Square"},{value:"pill",displayName:"Pill"}],m=[{value:"tree",displayName:"Tree"},{value:"table",displayName:"Table"}],g=[{value:"left",displayName:"Left"},{value:"center",displayName:"Center"},{value:"right",displayName:"Right"}],y=[{value:"normal",displayName:"Normal"},{value:"bold",displayName:"Bold"},{value:"italic",displayName:"Italic"},{value:"boldItalic",displayName:"Bold Italic"}];class v extends a{name="layout";displayName="Layout";slices=[new h({name:"orientation",displayName:"Orientation",items:c,value:c[0]}),new r({name:"levelSpacing",displayName:"Level spacing",value:70}),new r({name:"siblingSpacing",displayName:"Sibling spacing",value:18}),new r({name:"cardWidth",displayName:"Card width",value:120}),new r({name:"cardHeight",displayName:"Card height",value:40})]}class w extends a{name="appearance";displayName="Appearance";slices=[new o({name:"useBackground",displayName:"Use background",value:!0}),new n({name:"backgroundColor",displayName:"Background color",value:{value:"#ffffff"}})]}class b extends a{name="lines";displayName="Lines";slices=[new n({name:"lineColor",displayName:"Line color",value:{value:"#f3b27a"}}),new n({name:"activeColor",displayName:"Active line color",value:{value:"#f08b2e"}}),new r({name:"lineWidth",displayName:"Line width",value:1}),new h({name:"lineStyle",displayName:"Line style",items:p,value:p[0]}),new o({name:"showArrows",displayName:"Show pointers",value:!0}),new h({name:"tipStyle",displayName:"Line tip",items:u,value:u[0]}),new r({name:"tipSize",displayName:"Tip size",value:6})]}class x extends a{name="nodes";displayName="Nodes";slices=[new n({name:"fillColor",displayName:"Fill color",value:{value:"#ffffff"}}),new n({name:"strokeColor",displayName:"Border color",value:{value:"#e5e7eb"}}),new r({name:"strokeWidth",displayName:"Border width",value:1}),new r({name:"cornerRadius",displayName:"Corner radius",value:6}),new h({name:"shape",displayName:"Shape",items:f,value:f[0]}),new o({name:"showShadow",displayName:"Shadow",value:!0}),new n({name:"titleColor",displayName:"Title color",value:{value:"#111827"}}),new n({name:"valueColor",displayName:"Value color",value:{value:"#6b7280"}}),new h({name:"titleAlign",displayName:"Title align",items:g,value:g[1]}),new o({name:"titleWrap",displayName:"Title wrap",value:!0}),new r({name:"titleFontSize",displayName:"Title font size",value:11}),new d({name:"titleFontFamily",displayName:"Title font family",value:"Segoe UI",placeholder:"Segoe UI"}),new h({name:"titleFontStyle",displayName:"Title font style",items:y,value:y[1]})]}class S extends a{name="levels";displayName="Level colors";slices=[new o({name:"enableLevelColors",displayName:"Enable",value:!1}),new n({name:"level1Color",displayName:"Level 1",value:{value:"#ffffff"}}),new n({name:"level2Color",displayName:"Level 2",value:{value:"#f8fafc"}}),new n({name:"level3Color",displayName:"Level 3",value:{value:"#f1f5f9"}}),new n({name:"level4Color",displayName:"Level 4",value:{value:"#e2e8f0"}}),new n({name:"level5Color",displayName:"Level 5",value:{value:"#e0f2fe"}}),new n({name:"level6Color",displayName:"Level 6",value:{value:"#ede9fe"}})]}class F extends a{name="controls";displayName="Controls";slices=[new o({name:"showControls",displayName:"Show toolbar",value:!0}),new o({name:"showSearch",displayName:"Show search",value:!0}),new o({name:"showHierarchyFilter",displayName:"Show hierarchy filter",value:!0}),new o({name:"showParentFilter",displayName:"Show parent filter",value:!0}),new o({name:"showDropdownFilter",displayName:"Show dropdown filter",value:!0}),new o({name:"showZoom",displayName:"Show zoom",value:!0}),new o({name:"showViewToggle",displayName:"Show view toggle",value:!0}),new o({name:"showCollapseExpand",displayName:"Show collapse/expand",value:!0}),new h({name:"defaultView",displayName:"Default view",items:m,value:m[0]}),new r({name:"doubleClickZoomPercent",displayName:"Double-click zoom (%)",value:130})]}class C extends a{name="table";displayName="Table view";slices=[new o({name:"showHeader",displayName:"Show header",value:!0}),new r({name:"rowHeight",displayName:"Row height",value:28}),new o({name:"zebra",displayName:"Zebra rows",value:!0})]}class I extends l{layout=new v;appearance=new w;lines=new b;nodes=new x;levels=new S;controls=new F;table=new C;cards=[this.layout,this.appearance,this.lines,this.nodes,this.levels,this.controls,this.table]}},827(e,t,i){function s(e,t){let i=-1;for(const s of this)if(e.call(t,s,++i,this))return s}i.d(t,{A:()=>s})},902(e,t,i){function s(e){return null==e?null:function(e){if("function"!=typeof e)throw new Error;return e}(e)}i.d(t,{l:()=>s})},904(e,t,i){i.d(t,{A:()=>d});var s=i(902),l=i(70),a={depth:-1},o={},n={};function r(e){return e.id}function h(e){return e.parentId}function d(){var e,t=r,i=h;function d(s){var r,h,d,u,f,m,g,y,v=Array.from(s),w=t,b=i,x=new Map;if(null!=e){const t=v.map((t,i)=>function(e){let t=(e=`${e}`).length;return p(e,t-1)&&!p(e,t-2)&&(e=e.slice(0,-1)),"/"===e[0]?e:`/${e}`}(e(t,i,s))),i=t.map(c),l=new Set(t).add("");for(const e of i)l.has(e)||(l.add(e),t.push(e),i.push(c(e)),v.push(n));w=(e,i)=>t[i],b=(e,t)=>i[t]}for(d=0,r=v.length;d<r;++d)h=v[d],m=v[d]=new l.bP(h),null!=(g=w(h,d,s))&&(g+="")&&(y=m.id=g,x.set(y,x.has(y)?o:m)),null!=(g=b(h,d,s))&&(g+="")&&(m.parent=g);for(d=0;d<r;++d)if(g=(m=v[d]).parent){if(!(f=x.get(g)))throw new Error("missing: "+g);if(f===o)throw new Error("ambiguous: "+g);f.children?f.children.push(m):f.children=[m],m.parent=f}else{if(u)throw new Error("multiple roots");u=m}if(!u)throw new Error("no root");if(null!=e){for(;u.data===n&&1===u.children.length;)u=u.children[0],--r;for(let e=v.length-1;e>=0&&(m=v[e]).data===n;--e)m.data=null}if(u.parent=a,u.eachBefore(function(e){e.depth=e.parent.depth+1,--r}).eachBefore(l.lW),u.parent=null,r>0)throw new Error("cycle");return u}return d.id=function(e){return arguments.length?(t=(0,s.l)(e),d):t},d.parentId=function(e){return arguments.length?(i=(0,s.l)(e),d):i},d.path=function(t){return arguments.length?(e=(0,s.l)(t),d):e},d}function c(e){let t=e.length;if(t<2)return"";for(;--t>1&&!p(e,t););return e.slice(0,t)}function p(e,t){if("/"===e[t]){let i=0;for(;t>0&&"\\"===e[--t];)++i;if(!(1&i))return!0}return!1}}},t={};function i(s){var l=t[s];if(void 0!==l)return l.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{i.r(s),i.d(s,{default:()=>a});var e=i(279),t=window.powerbi,l={name:"HierarchyFlowA1B2C3D4E5F6G7H8I9J0",displayName:"Hierarchy Flow",class:"Visual",apiVersion:"5.3.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,i)=>{const s=globalThis.dialogRegistry;e in s&&new s[e](t,i)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.HierarchyFlowA1B2C3D4E5F6G7H8I9J0=l);const a=l})(),HierarchyFlowA1B2C3D4E5F6G7H8I9J0=s})();